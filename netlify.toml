[build]
  command = "SKIP_PREFLIGHT_CHECK=true CI=false npm run build"
  publish = "build"

[build.environment]
  NODE_VERSION = "18.16.0"
  NPM_VERSION = "9.5.1"
  CI = "false"

# 保留 Netlify 子域名重定向
[[redirects]]
  from = "/*"
  to = "https://sentimentinsideout.com/:splat"
  status = 301
  force = true
  conditions = {Host = ["niku-stock.netlify.app"]}

# API 代理
#staging網址 "https://sentiment-staging.publicvm.com/api/:splat"
#production網址 "https://stockdatabase.publicvm.com/api/:splat"


# SPA 回退路由
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = false


[context.branch-deploy]
  command = "SKIP_PREFLIGHT_CHECK=true CI=false npm run build"
  publish = "build"

[context.branch-deploy.environment]
  NODE_VERSION = "18.16.0"
  NPM_VERSION = "9.5.1"
  CI = "false"


# 網站快取策略
# --- 第一類：檔名帶有亂數的資源，應該永久快取 ---
# 這些檔案的內容若有變更，檔名也會跟著變，所以可以安全地快取一年。
[[headers]]
  for = "/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# --- 第二類：檔名固定的資源，應該短時間快取 ---
# 這些檔案的內容可能會更新，但檔名不變，所以設定較短的快取時間（例如 2 小時）。
[[headers]]
  for = "/locales/*"
  [headers.values]
    Cache-Control = "public, max-age=7200, must-revalidate"

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=7200, must-revalidate"
    
[[headers]]
  for = "/*.(ico|png|jpg|jpeg|gif|svg|json|txt|xml)"
  [headers.values]
    Cache-Control = "public, max-age=7200, must-revalidate"

# --- 第三類：入口 HTML 檔案，永遠不快取 ---
# 為了確保使用者總能載入最新的網站版本，index.html 永遠不能被瀏覽器快取。
# Netlify 會為所有未被上方規則匹配到的 HTML 檔案自動設定 no-cache，所以這裡無需額外設定。