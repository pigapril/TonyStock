[build]
  command = "CI=false npm run build"
  publish = "build"

# Production 環境設定
[context.production]
  command = "CI=false npm run build"

# Staging/Deploy Preview 環境設定
[context.deploy-preview]
  command = "CI=false npm run build"

[context.branch-deploy]
  command = "CI=false npm run build"

# 重定向規則（按優先級排序）

# 1. 處理 niku-stock.netlify.app 的重定向
[[redirects]]
  from = "https://niku-stock.netlify.app/*"
  to = "https://sentimentinsideout.com/:splat"
  status = 301
  force = true

# 2. 針對 staging 域名的 robots.txt 重定向
[[redirects]]
  from = "/robots.txt"
  to = "/robots-staging.txt"
  status = 200
  conditions = {Domain = ["sentimentinsideout-staging.netlify.app"]}
  force = true

# 3. 舊的靜態頁面 URL 重定向到 zh-TW 版本
[[redirects]]
  from = "/about"
  to = "/zh-TW/about"
  status = 301

[[redirects]]
  from = "/legal"
  to = "/zh-TW/legal"
  status = 301

[[redirects]]
  from = "/priceanalysis"
  to = "/zh-TW/priceanalysis"
  status = 301

[[redirects]]
  from = "/watchlist"
  to = "/zh-TW/watchlist"
  status = 301

[[redirects]]
  from = "/market-sentiment"
  to = "/zh-TW/market-sentiment"
  status = 301

[[redirects]]
  from = "/sponsor-us"
  to = "/zh-TW/sponsor-us"
  status = 301

# 4. 舊文章 URL 重定向
[[redirects]]
  from = "/articles/:slug"
  to = "/zh-TW/articles/:slug"
  status = 301

# 5. 重定向舊的 sitemap 網址
[[redirects]]
  from = "https://sitemap.sentimentinsideout.com/priceanalysis"
  to = "https://sentimentinsideout.com/en/priceanalysis"
  status = 301

# 6. 靜態資源：直接返回（不重定向）
[[redirects]]
  from = "/static/*"
  to = "/static/:splat"
  status = 200

# 7. SPA 回退路由（必須放在最後）
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
