[build]
  command = "SKIP_PREFLIGHT_CHECK=true CI=false npm run build"
  publish = "build"

[build.environment]
  NODE_VERSION = "18.16.0"
  NPM_VERSION = "9.5.1"
  CI = "false"

# 保留 Netlify 子域名重定向
[[redirects]]
  from = "/*"
  to = "https://sentimentinsideout.com/:splat"
  status = 301
  force = true
  conditions = {Host = ["niku-stock.netlify.app"]}

# API 代理
#staging網址 "https://sentiment-staging.publicvm.com/api/:splat"
#production網址 "https://stockdatabase.publicvm.com/api/:splat"
[[redirects]]
  from = "/api/*"
  to = "https://stockdatabase.publicvm.com/api/:splat"
  status = 200
  force = true

# SPA 回退路由
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = false

[context.production.environment]
  REACT_APP_API_BASE_URL = ""

[context.deploy-preview.environment]
  REACT_APP_API_BASE_URL = ""

[context.branch-deploy]
  command = "SKIP_PREFLIGHT_CHECK=true CI=false npm run build"
  publish = "build"

[context.branch-deploy.environment]
  REACT_APP_API_BASE_URL = ""
  NODE_VERSION = "18.16.0"
  NPM_VERSION = "9.5.1"
  CI = "false"
  
[[headers]]
  for = "/static/media/*" # 適用於所有位於 static/media/ 下的檔案 (包含 sponsor_icon.gif)
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable" # 快取一年，並標記為不可變 (適合帶哈希值的檔案名)

[[headers]]
  for = "/images/*" # 也適用於 /public/images/ 下的圖片 (Home.js 使用的 home-featureX 圖片)
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.(js|css)" # 對於 JavaScript 和 CSS 檔案也設定長快取
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# 針對其他靜態資源，例如根目錄下的 logo.png, manifest.json, favicons
# 如果這些檔案名沒有哈希值，則不使用 immutable
[[headers]]
  for = "/*.(png|jpg|jpeg|gif|svg|ico|json|xml|txt)"
  [headers.values]
    Cache-Control = "public, max-age=31536000"